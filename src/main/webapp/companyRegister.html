<!DOCTYPE html>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
	<meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="">
    <meta name="author" content="">

    <link rel="shortcut icon" href="img/logo.png">
	
	<title>Afw Company Page</title>
	
	      <!-- Bootstrap core CSS -->
	<link href="css/bootstrap.min.css" rel="stylesheet">
	<link href="css/bootstrap-reset.css" rel="stylesheet">
	
	<!--Animation css-->
	<link href="css/animate.css" rel="stylesheet">
	
	<!-- sweet alerts -->
	<link href="assets/sweet-alert/sweet-alert.min.css" rel="stylesheet">
	
	<!--Icon-fonts css-->
	<link href="assets/font-awesome/css/font-awesome.css" rel="stylesheet" />
	<link href="assets/ionicon/css/ionicons.min.css" rel="stylesheet" />
	
	<!-- DataTables -->
	<link href="assets/datatables/jquery.dataTables.min.css" rel="stylesheet" type="text/css" />
	<link href="assets/datatables/responsive.dataTables.min.css" rel="stylesheet" type="text/css" />
	
	<!-- Custom styles for this template -->
	<link href="css/style.css" rel="stylesheet">
	<link href="css/helper.css" rel="stylesheet">
	
	<link href="css/common.css" rel="stylesheet">
	
	<!-- HTML5 shim and Respond.js IE8 support of HTML5 tooltipss and media queries -->
	<!--[if lt IE 9]>
	  <script src="js/html5shiv.js"></script>
	  <script src="js/respond.min.js"></script>
	<![endif]-->
<style>
.company_link:hover {
    text-decoration: underline;
}
</style>
</head>
<body>
	<!-- Aside Start-->
 	<aside class="left-panel">

	    <!-- brand -->
	    <div class="logo">
	        <a href="index.html" class="logo-expanded">
<!-- 	            <img src="img/logo.png" alt="logo"> -->
				<i class="ion-social-buffer"></i>
				<span class="nav-label">AFW_SYSTEM</span>
	        </a>
	    </div>
	    <!-- / brand -->
	
	    <!-- Navbar Start -->
	    <nav class="navigation">
	        <ul class="list-unstyled">
	            <li class="has-submenu active"><a href="#"><i class="ion-compose"></i> <span class="nav-label">客戶資料</span></a>
	                <ul class="list-unstyled">
	                    <li><a href="addCompany.html">新增客戶合約</a></li>
	                    <li><a href="company.html">全部客戶</a></li>
	                    <li><a href="companyOffice.html">辦公室</a></li>
	                    <li><a href="companyPersonal.html">個人座位</a></li>
	                    <li class="active"><a href="companyRegister.html">登記</a></li>
	                    <li><a href="companyCC.html">聯絡處 & 停業</a></li>
	                    <li><a href="companyClose.html">退租</a></li>
	                </ul>
	            </li>
				<li class="has-submenu"><a href="#"><i class="ion-grid"></i> <span class="nav-label">收租</span></a>
	                <ul class="list-unstyled">
	                	<li><a href="searchRentTable.html">搜尋</a></li>
	                    <li><a href="rentTable.html">收租表</a></li>
	                    <li><a href="rentListTable.html">收費清單</a></li>
	                </ul>
	            </li>
	            <li class="has-submenu" id="adminReconciliation" style="display:none">
	            	<a href="#"><i class="ion-stats-bars"></i> <span class="nav-label">對帳報表</span></a>
	                <ul class="list-unstyled">
	                    <li class="active"><a href="reconciliationTable.html">對帳</a></li>
	                    <li><a href="404.html">營收報表</a></li>
	                </ul>
	            </li>
	        </ul>
	    </nav> 
	</aside>
	<!-- Aside Ends-->
	
	<!--Main Content Start -->
    <section class="content">
        <!-- Header -->
        <header class="top-head container-fluid">
        	<button type="button" class="navbar-toggle pull-left">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <!-- user login dropdown start-->
            <ul class="nav navbar-nav navbar-right top-menu top-right-menu">
	            <li class="dropdown text-center">
	                <a data-toggle="dropdown" class="dropdown-toggle" href="#">
	                    <img alt="" src="img/logo.png" class="img-circle profile-img thumb-sm">
	                    <span class="username" id="userName">AFW</span> <span class="caret"></span>
	                </a>
	                <ul class="dropdown-menu pro-menu fadeInUp animated" tabindex="5003" style="overflow: hidden; outline: none;">
	                    <li><a href="#" id="logOut"><i class="fa fa-sign-out"></i> Log Out</a></li>
	                </ul>
	            </li>
            </ul>
        </header>
        <!-- Header Ends -->


        <!-- Page Content Start -->
        <!-- ================== -->

        <div class="wraper container-fluid">
			<div class="page-title"> 
                <h3 class="title"></h3> 
            </div>

			<!-- 根據不同權限看到不同分公司的客戶 table動態產生 thead也動態產生 目前先show admin的畫面-->
            <div class="row">
                <div class="col-md-12">
                    <div class="panel panel-default">
                        <div class="panel-heading">
                            <h3 class="panel-title">登記</h3>
                        </div>
                        <div id="branchSelection" style="width:25%; display:none;">
							<div class="form-group">
								<label for="sel1">分店</label>
								<select class="form-control" id="branchOffice">
								    <option value="-1">請選擇</option>
	                          		<option value="221">微風店</option>
	                          		<option value="169">敦化店</option>
	                          		<option value="222">大安店</option>
	                          		<option value="295">忠孝店</option>
	                          		<option value="201">復興店</option>
	                          		<option value="189">南京店</option>
								</select>
							</div>
						</div>
                        <div class="panel-body">
                            <div class="row">
                                <div class="col-md-12 col-sm-12 col-xs-12">
                                    <table id="datatable" class="table table-striped table-bordered" style="width: 100%;">
                                        <thead>
											<tr>
												<th>id</th>
                                                <th>公司名稱</th>
                                                <th>負責人</th>
                                                <th>電話</th>
                                                <th>傳真</th>
                                                <th>Email</th>
                                                <th>寄件方式</th>
                                                <th>轉寄地址</th>
                                                <th>備註</th>
											</tr>
                                        </thead>
                                        <tbody></tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
			</div> <!-- End Row -->
        </div>
        
        
        <!-- Page Content Ends -->
        <!-- ================== -->

        <!-- Footer Start -->
        <footer class="footer">
            2016 © AFW.
        </footer>
        <!-- Footer Ends -->


    </section>
    <!-- Main Content Ends -->




<!-- js placed at the end of the document so the pages load faster -->
<script src="js/jquery.js"></script>
<script src="js/bootstrap.min.js"></script>
<script src="js/pace.min.js"></script>
<script src="js/modernizr.min.js"></script>
<script src="js/wow.min.js"></script>
<script src="js/jquery.scrollTo.min.js"></script>
<script src="js/jquery.nicescroll.js" type="text/javascript"></script>
<script src="js/jquery.app.js"></script>
<script src="assets/datatables/jquery.dataTables.min.js"></script>
<script src="assets/datatables/dataTables.responsive.min.js"></script>
<script src="assets/datatables/dataTables.bootstrap.js"></script>

<script src="js/common.js"></script>
<script>
(function($){
//////////ajax
    var root = location.protocol + '//' + location.host;
    
    var retriveCompanyAjax = function(selectBranch) {
    	var table;
    	$.ajax({
			url:root + "/AFW-I-System/retrive/company/r/" + selectBranch,
			type:'get',
			dataType : 'json',
			contentType: 'application/json',
			success : function(response) {
				//alert("success");
				console.log("retriveCompanyAjax:" + response.message);
				if(response.status == 'success') {
					//console.log(response.message);
					var data = jQuery.parseJSON(response.message);
					
					for(var i=0; i<data.length; i++) {
						console.log(data[i]);
					}
					if(response.user == 'AA') {
						$('#branchSelection').css('display', 'block');
					}
					handleDataTable(data);
					$('#branchOffice').val(selectBranch);
				}
			},
			error : function(e) {
				alert("error");
				console.log("ERROR: ", e);
			},
			done : function(e) {
				console.log("DONE");
			}
		});
    }
    
    
    var handleDataTable = function(data) {
    	
    	var table = $('#datatable').dataTable({
			oLanguage: {
				'sProcessing':'處理中...',
				'sLengthMenu':'顯示 _MENU_ 項結果',
				'sZeroRecords':'沒有匹配結果',
				'sInfo':'顯示第 _START_ 至 _END_ 項結果，共 _TOTAL_ 項',
				'sInfoEmpty':'顯示第 0 至 0 項結果，共 0 項',
				'sInfoFiltered':'(從 _MAX_ 項結果過濾)',
				'sInfoPostFix':'',
				'sSearch':'搜索:',
				'sUrl':'',
				'oPaginate': {
					'sFirst':'首頁',
					'sPrevious':'上頁',
					'sNext':'下頁',
					'sLast':'尾頁'
				}
			},
			'data': data,
	        'columns': [
// 	        		{
// 	        		'class':'details-control',
// 	        		'orderable':false,
// 	        		'data':null,
// 	        		'defaultContent': ''
// 	        		},
					{"data": function(row, type, val, meta) {
	        			return row.company.companyId;
	        		},"visible": false},
					{"data": function(row, type, val, meta) {
	        			return "<a class=\"company_link\" href=\"companyProfile.html?id="+ row.company.companyId +"\">" + row.company.companyName + "</a>";
	        		}},
	        		{"data": function(row, type, val, meta) {
	        			return row.company.companyExecutive;
	        		}},
	        		{"data": function(row, type, val, meta) {
	        			return row.company.companyNumber;
	        		}},
	        		{"data": function(row, type, val, meta) {
	        			if(row.company.companyFax != null) {
	        				return row.company.companyFax;
	        			} else {
	        				return "";
	        			}
	        		}},
	        		{"data": function(row, type, val, meta) {
	        			if(row.company.companyMail != null) {
	        				return row.company.companyMail;
	        			} else {
	        				return "";
	        			}
	        		}},
	        		{"data": function(row, type, val, meta) {
	        			if(row.company.companyLetterStatus != null) {
	        				return row.company.companyLetterStatus;
	        			} else {
	        				return "";
	        			}
	        		}},
	        		{"data": function(row, type, val, meta) {
	        			if(row.company.companyAddress2 != null) {
	        				return row.company.companyAddress2;
	        			} else {
	        				return "";
	        			}
	        		}},
	        		{"data": function(row, type, val, meta) {
	        			if(row.company.companyRemark != null) {
	        				return row.company.companyRemark;
	        			} else {
	        				return "";
	        			}
	        		}},
	        ],
	        
	        "order": [[0, 'asc']]
		});
    	
    	//javascript by jquery
//     	$('#datatable thead th').each(function() {
//             var title = $('#datatable tfoot th').eq($(this).index()).text();
//             $(this).html('<input type="text" style="width:100%; padding:3px; box-sizing:border-box;" placeholder="Search '+title+'" />');
//         } );
    	
//     	var table = $('#datatable').DataTable();
    	
//      	// Apply the search
//         table.columns().eq( 0 ).each( function ( colIdx ) {
//             $( 'input', table.column( colIdx ).header() ).on( 'keyup change', function () {
//                 table
//                     .column( colIdx )
//                     .search( this.value )
//                     .draw();
//             } );
//         });
     	
//         //the search boxes on top without replacing the columns titles
//         var r = $('#datatable tfoot tr');
//         r.find('th').each(function(){
//           $(this).css('padding', 8);
//         });
//         $('#datatable thead').append(r);
    }
    
    $("#branchOffice").change(function() {
    	var selectBranch = $('#branchOffice').val();
    	window.location.href = root + "/AFW-I-System/companyRegister.html?branch=" + selectBranch;
    });
    
    var getUrlParameter = function getUrlParameter(sParam) {
	    var sPageURL = decodeURIComponent(window.location.search.substring(1)),
	        sURLVariables = sPageURL.split('&'),
	        sParameterName,
	        i;

	    for (i = 0; i < sURLVariables.length; i++) {
	        sParameterName = sURLVariables[i].split('=');

	        if (sParameterName[0] === sParam) {
	            return sParameterName[1] === undefined ? true : sParameterName[1];
	        }
	    }
	};
	
	var checkSession = function() {
		$.ajax({
			url:root + "/AFW-I-System/session/user/check",
			type:'get',
			dataType : 'json',
			contentType: 'application/json',
			success : function(response) {
				//alert("success");
				if(response.status == 'success') {
					if(response.message == false) {
						alert("請重新登入");
						window.location.href = root + "/AFW-I-System/login.html";
						return false;
					} else {
						var branch = getUrlParameter('branch');
				    	if(branch === undefined) {
				    		branch = '-1';
				    	}
				    	retriveCompanyAjax(branch);
				    	setUserInfoNavBar(response.userCode);
				    	hiddenInfo(response.userCode);
					}
				}
			},
			error : function(e) {
				alert("error");
				console.log("ERROR: ", e);
			},
			done : function(e) {
				console.log("DONE");
			}
		});
		
		return true;
	};
	
	var setUserInfoNavBar = function(userCode) {
    	var name = '';
    	switch(userCode) {
	    	case 'AA': name = '管理員'; break;
	    	case '189': name = '南京店'; break;
	    	case '201': name = '復興店'; break;
	    	case '221': name = '微風店'; break;
	    	case '222': name = '大安店'; break;
	    	case '169': name = '敦化店'; break;
	    	case '295': name = '忠孝店'; break;
    	}
    	$('#userName').text(name);
    }
	
	var hiddenInfo = function(userCode) {
		if(userCode == 'AA') {
			$('#adminReconciliation').css('display', 'block');
		}
	};
	
	//page load
    window.onload = function() {
    	checkSession();
    	
	};
})(jQuery);
</script>
</body>
</html>