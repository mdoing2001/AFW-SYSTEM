<!DOCTYPE html>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
	<meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="">
    <meta name="author" content="">

    <link rel="shortcut icon" href="img/logo.png">
	
	<title>Afw Company Page</title>
	
	      <!-- Bootstrap core CSS -->
	<link href="css/bootstrap.min.css" rel="stylesheet">
	<link href="css/bootstrap-reset.css" rel="stylesheet">
	
	<!--Animation css-->
	<link href="css/animate.css" rel="stylesheet">
	
	<!-- sweet alerts -->
	<link href="assets/sweet-alert/sweet-alert.min.css" rel="stylesheet">
	
	<!--Icon-fonts css-->
	<link href="assets/font-awesome/css/font-awesome.css" rel="stylesheet" />
	<link href="assets/ionicon/css/ionicons.min.css" rel="stylesheet" />
	
	<!-- DataTables -->
	<link href="assets/datatables/jquery.dataTables.min.css" rel="stylesheet" type="text/css" />
	<link href="assets/datatables/responsive.dataTables.min.css" rel="stylesheet" type="text/css" />
	
	<!-- Custom styles for this template -->
	<link href="css/style.css" rel="stylesheet">
	<link href="css/helper.css" rel="stylesheet">
	
	<link href="css/common.css" rel="stylesheet">
	
	<!-- HTML5 shim and Respond.js IE8 support of HTML5 tooltipss and media queries -->
	<!--[if lt IE 9]>
	  <script src="js/html5shiv.js"></script>
	  <script src="js/respond.min.js"></script>
	<![endif]-->
<style>
.company_link:hover {
    text-decoration: underline;
}
</style>
</head>
<body>
	<!-- Aside Start-->
 	<aside class="left-panel">

	    <!-- brand -->
	    <div class="logo">
	        <a href="index.html" class="logo-expanded">
<!-- 	            <img src="img/logo.png" alt="logo"> -->
				<i class="ion-social-buffer"></i>
				<span class="nav-label">AFW_SYSTEM</span>
	        </a>
	    </div>
	    <!-- / brand -->
	
	    <!-- Navbar Start -->
	    <nav class="navigation">
	        <ul class="list-unstyled">
<!-- 	            <li><a href="index.html"><i class="ion-home"></i> <span class="nav-label">Dashboard</span></a></li> -->
<!-- 	            <li class="has-submenu"><a href="#"><i class="ion-flask"></i> <span class="nav-label">UI Elements</span></a> -->
<!-- 	                <ul class="list-unstyled"> -->
<!-- 	                    <li><a href="typography.html">Typography</a></li> -->
<!-- 	                    <li><a href="buttons.html">Buttons</a></li> -->
<!-- 	                    <li><a href="icons.html">Icons</a></li> -->
<!-- 	                    <li><a href="panels.html">Panels</a></li> -->
<!-- 	                    <li><a href="tabs-accordions.html">Tabs &amp; Accordions</a></li> -->
<!-- 	                    <li><a href="modals.html">Modals</a></li> -->
<!-- 	                    <li><a href="bootstrap-ui.html">BS Elements</a></li> -->
<!-- 	                    <li><a href="progressbars.html">Progress Bars</a></li> -->
<!-- 	                    <li><a href="notification.html">Notification</a></li> -->
<!-- 	                    <li><a href="sweet-alert.html">Sweet-Alert</a></li> -->
<!-- 	                </ul> -->
<!-- 	            </li> -->
<!-- 	            <li class="has-submenu"><a href="#"><i class="ion-settings"></i> <span class="nav-label">Components</span><span class="badge bg-success">New</span></a> -->
<!-- 	                <ul class="list-unstyled"> -->
<!-- 	                    <li><a href="grid.html">Grid</a></li> -->
<!-- 	                    <li><a href="portlets.html">Portlets</a></li> -->
<!-- 	                    <li><a href="widgets.html">Widgets</a></li> -->
<!-- 	                    <li><a href="nestable-list.html">Nesteble</a></li> -->
<!-- 	                    <li><a href="calendar.html">Calendar</a></li> -->
<!-- 	                    <li><a href="ui-sliders.html">Range Slider</a></li> -->
<!-- 	                </ul> -->
<!-- 	            </li> -->
	            <li class="has-submenu active"><a href="#"><i class="ion-compose"></i> <span class="nav-label">客戶資料</span></a>
	                <ul class="list-unstyled">
	                    <li><a href="addCompany.html">新增客戶合約</a></li>
	                    <li class="active"><a href="company.html">全部客戶</a></li>
	                    <li><a href="companyOffice.html">辦公室</a></li>
	                    <li><a href="companyPersonal.html">個人座位</a></li>
	                    <li><a href="companyRegister.html">登記</a></li>
	                    <li><a href="companyCC.html">聯絡處 & 停業</a></li>
	                    <li><a href="companyClose.html">退租</a></li>
	                </ul>
	            </li>
				<li class="has-submenu"><a href="#"><i class="ion-grid"></i> <span class="nav-label">收租</span></a>
	                <ul class="list-unstyled">
	                	<li><a href="searchRentTable.html">搜尋</a></li>
	                    <li><a href="rentTable.html">收租表</a></li>
	                </ul>
	            </li>
	        </ul>
	    </nav> 
	</aside>
	<!-- Aside Ends-->
	
	<!--Main Content Start -->
    <section class="content">
        <!-- Header -->
        <header class="top-head container-fluid">
        	<button type="button" class="navbar-toggle pull-left">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <!-- user login dropdown start-->
            <ul class="nav navbar-nav navbar-right top-menu top-right-menu">
	            <li class="dropdown text-center">
	                <a data-toggle="dropdown" class="dropdown-toggle" href="#">
	                    <img alt="" src="img/logo.png" class="img-circle profile-img thumb-sm">
	                    <span class="username" id="userName">AFW</span> <span class="caret"></span>
	                </a>
	                <ul class="dropdown-menu pro-menu fadeInUp animated" tabindex="5003" style="overflow: hidden; outline: none;">
	                    <li><a href="#" id="logOut"><i class="fa fa-sign-out"></i> Log Out</a></li>
	                </ul>
	            </li>
            </ul>
            <!-- user login dropdown end -->
        </header>
        <!-- Header Ends -->


        <!-- Page Content Start -->
        <!-- ================== -->

        <div class="wraper container-fluid">
			<div class="page-title"> 
                <h3 class="title"></h3> 
            </div>

			<!-- 根據不同權限看到不同分公司的客戶 table動態產生 thead也動態產生 目前先show admin的畫面-->
            <div class="row">
                <div class="col-md-12">
                    <div class="panel panel-default">
                        <div class="panel-heading">
                            <h3 class="panel-title">基本資料</h3>
                        </div>
                        <div class="panel-body">
                            <div class="row">
                                <div class="col-md-12 col-sm-12 col-xs-12">
                                    <table id="datatable" class="table table-striped table-bordered" style="width: 100%;">
                                        <thead>
                                            <tr>
                                                <th>公司名稱</th>
                                                <th>統編</th>
                                                <th>登記地</th>
                                                <th>負責人</th>
                                                <th>公司類型</th>
                                                <th>轉寄地址</th>
                                                <th>備註</th>
                                            </tr>
                                        </thead>
										<tfoot>
								            <tr>
                                                <th>公司名稱</th>
                                                <th>統編</th>
                                                <th>登記地</th>
                                                <th>負責人</th>
                                                <th>公司類型</th>
                                                <th>轉寄地址</th>
                                                <th>備註</th>
								            </tr>
								        </tfoot>
                                        <tbody></tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
			</div> <!-- End Row -->
        </div>
        
        
        <!-- Page Content Ends -->
        <!-- ================== -->

        <!-- Footer Start -->
        <footer class="footer">
            2016 © AFW.
        </footer>
        <!-- Footer Ends -->


    </section>
    <!-- Main Content Ends -->




<!-- js placed at the end of the document so the pages load faster -->
<script src="js/jquery.js"></script>
<script src="js/bootstrap.min.js"></script>
<script src="js/pace.min.js"></script>
<script src="js/modernizr.min.js"></script>
<script src="js/wow.min.js"></script>
<script src="js/jquery.scrollTo.min.js"></script>
<script src="js/jquery.nicescroll.js" type="text/javascript"></script>
<script src="js/jquery.app.js"></script>
<script src="assets/datatables/jquery.dataTables.min.js"></script>
<script src="assets/datatables/dataTables.responsive.min.js"></script>
<script src="assets/datatables/dataTables.bootstrap.js"></script>

<script src="js/common.js"></script>

<script>
(function($){
	
 
	//need to responsive
    // DataTable
//     var table = $('#datatable').DataTable({
//     	responsive: true
//     });
    
	<!-------------------------------------------------------------------->
    //////////ajax
    var root = location.protocol + '//' + location.host;
    
    var retriveCompanyAjax = function() {
    	var table;
    	$.ajax({
			url:root + "/AFW-I-System/retrive/company",
			type:'get',
			dataType : 'json',
			contentType: 'application/json',
			success : function(response) {
				//alert("success");
				//console.log("retriveCompanyAjax:" + response.message);
				if(response.status == 'success') {
					//console.log(response.message);
					var data = jQuery.parseJSON(response.message);
					
					for(var i=0; i<data.length; i++) {
						console.log(data[i]);
					}
					handleDataTable(data);
					
				} 
// 				else {
// 					alert(response.message);
// 					window.location.href = root + "/AFW-I-System/login.html";
// 				}
			},
			error : function(e) {
				alert("error");
				console.log("ERROR: ", e);
			},
			done : function(e) {
				console.log("DONE");
			}
		});
    }
    
    
    var handleDataTable = function(data) {
    	
    	var table = $('#datatable').dataTable({
			oLanguage: {
				'sProcessing':'處理中...',
				'sLengthMenu':'顯示 _MENU_ 項結果',
				'sZeroRecords':'沒有匹配結果',
				'sInfo':'顯示第 _START_ 至 _END_ 項結果，共 _TOTAL_ 項',
				'sInfoEmpty':'顯示第 0 至 0 項結果，共 0 項',
				'sInfoFiltered':'(從 _MAX_ 項結果過濾)',
				'sInfoPostFix':'',
				'sSearch':'搜索:',
				'sUrl':'',
				'oPaginate': {
					'sFirst':'首頁',
					'sPrevious':'上頁',
					'sNext':'下頁',
					'sLast':'尾頁'
				}
			},
			'data': data,
	        'columns': [
// 	        		{
// 	        		'class':'details-control',
// 	        		'orderable':false,
// 	        		'data':null,
// 	        		'defaultContent': ''
// 	        		},
// 	        		{"data": function(row, type, val, meta) {
// 	        			if(row.officeNumber != null) {
// 	        				return row.officeNumber;
// 	        			} else {
// 	        				return "";
// 	        			}
// 	        		}},
	        		//need to combine <a></a>
					{"data": function(row, type, val, meta) {
	        			return "<a class=\"company_link\" href=\"companyProfile.html?id="+ row.company.companyId +"\">" + row.company.companyName + "</a>";
	        		}},
	        		{"data": function(row, type, val, meta) {
	        			return row.company.companyEin;
	        		}},
	        		{"data": function(row, type, val, meta) {
	        			return row.company.companyCode;
	        		}},
	        		{"data": function(row, type, val, meta) {
	        			return row.company.companyExecutive;
	        		}},
	        		{"data": function(row, type, val, meta) {
	        			return row.company.companyType;
	        		}},
	        		{"data": function(row, type, val, meta) {
	        			return row.company.companyAddress2;
	        		}},
	        		{"data": function(row, type, val, meta) {
	        			return row.company.companyRemark;
	        		}},
	        ],
	        
	        "order": [[1, 'desc']]
		});
    	
    	//javascript by jquery
    	$('#datatable thead th').each(function() {
            var title = $('#datatable tfoot th').eq($(this).index()).text();
            $(this).html('<input type="text" style="width:100%; padding:3px; box-sizing:border-box;" placeholder="Search '+title+'" />');
        } );
    	
    	var table = $('#datatable').DataTable();
    	
     	// Apply the search
        table.columns().eq( 0 ).each( function ( colIdx ) {
            $( 'input', table.column( colIdx ).header() ).on( 'keyup change', function () {
                table
                    .column( colIdx )
                    .search( this.value )
                    .draw();
            } );
        });
     	
        //the search boxes on top without replacing the columns titles
        var r = $('#datatable tfoot tr');
        r.find('th').each(function() {
          $(this).css('padding', 8);
        });
        $('#datatable thead').append(r);
    }
    
    var checkSession = function() {
		$.ajax({
			url:root + "/AFW-I-System/session/user/check",
			type:'get',
			dataType : 'json',
			contentType: 'application/json',
			success : function(response) {
				//alert("success");
				if(response.status == 'success') {
					if(response.message == false) {
						alert("請重新登入");
						window.location.href = root + "/AFW-I-System/login.html";
						return false;
					} else {
						retriveCompanyAjax();
					}
				}
			},
			error : function(e) {
				alert("error");
				console.log("ERROR: ", e);
			},
			done : function(e) {
				console.log("DONE");
			}
		});
		
		return true;
	};
	
	//page load
    window.onload = function() {
    	checkSession();
    	
	};
    
})(jQuery);
</script>
</body>
</html>